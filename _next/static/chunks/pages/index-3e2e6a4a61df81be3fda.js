_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[6],{"/EDR":function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s("23aj")}])},"1YUq":function(e,t,s){e.exports={screen:"Screen_screen__1PV75",display:"Screen_display__3tQKg"}},"23aj":function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return Re}));var i=s("nKUr"),r=s("vRNQ"),a=s.n(r),c=s("q1tI"),n=s.n(c),h=s("hDqR"),d=s.n(h),l=128,o=64,u=32,y=16,p=8,g=4,b=2,v=1,f=s("zi88"),C=s.n(f),m=n.a.forwardRef((function(e,t){var s=Object(c.useRef)(),r=Object(c.useRef)(),a=Object(c.useRef)(),h=Object(c.useRef)(),d=Object(c.useRef)(),l=Object(c.useRef)();return n.a.useImperativeHandle(t,(function(){return{keydownUp:function(){s.current.classList.add(C.a.active)},keyupUp:function(){s.current.classList.remove(C.a.active)},keydownRight:function(){r.current.classList.add(C.a.active)},keyupRight:function(){r.current.classList.remove(C.a.active)},keydownDown:function(){a.current.classList.add(C.a.active)},keyupDown:function(){a.current.classList.remove(C.a.active)},keydownLeft:function(){h.current.classList.add(C.a.active)},keyupLeft:function(){h.current.classList.remove(C.a.active)},keydownA:function(){d.current.classList.add(C.a.active)},keyupA:function(){d.current.classList.remove(C.a.active)},keydownB:function(){l.current.classList.add(C.a.active)},keyupB:function(){l.current.classList.remove(C.a.active)}}})),Object(i.jsxs)("div",{className:C.a["action-buttons"],children:[Object(i.jsxs)("div",{className:C.a.dpad,children:[Object(i.jsx)("div",{ref:s,className:C.a["up-button"],children:Object(i.jsx)("span",{className:"".concat(C.a.arrow," ").concat(C.a["up-arrow"])})}),Object(i.jsx)("div",{ref:r,className:C.a["right-button"],children:Object(i.jsx)("span",{className:"".concat(C.a.arrow," ").concat(C.a["right-arrow"])})}),Object(i.jsx)("div",{ref:a,className:C.a["down-button"],children:Object(i.jsx)("span",{className:"".concat(C.a.arrow," ").concat(C.a["down-arrow"])})}),Object(i.jsx)("div",{className:C.a["dent-button"],children:Object(i.jsx)("span",{className:C.a["dent-circle"],children:Object(i.jsx)("span",{className:"".concat(C.a["dent-highlight"])})})}),Object(i.jsx)("div",{ref:h,className:C.a["left-button"],children:Object(i.jsx)("span",{className:"".concat(C.a.arrow," ").concat(C.a["left-arrow"])})})]}),Object(i.jsx)("div",{ref:d,className:"".concat(C.a["ab-button"]," ").concat(C.a["a-button"]),children:Object(i.jsx)("span",{className:C.a["button-height"],children:"A"})}),Object(i.jsx)("div",{ref:l,className:"".concat(C.a["ab-button"]," ").concat(C.a["b-button"]),children:Object(i.jsx)("span",{className:C.a["button-height"],children:"B"})})]})}));function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function O(e,t,s){return t&&A(e.prototype,t),s&&A(e,s),e}var P=s("cpVT"),w=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30],S=[[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,1,1],[0,0,0,0,1,1,1,1],[1,1,1,1,1,1,0,0]],j=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068],B=[15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],L=[428,380,340,320,286,254,226,214,190,160,142,128,106,84,72,54],R=function(){function e(){k(this,e),Object(P.a)(this,"volume",void 0),Object(P.a)(this,"cpuBus",void 0),Object(P.a)(this,"bytesRemaining",void 0),Object(P.a)(this,"interrupt",void 0),Object(P.a)(this,"isInterrupted",void 0),Object(P.a)(this,"isEnabled",void 0),Object(P.a)(this,"isMuted",void 0),Object(P.a)(this,"isIRQEnabled",void 0),Object(P.a)(this,"isLoopEnabled",void 0),Object(P.a)(this,"frequency",void 0),Object(P.a)(this,"loadCounter",void 0),Object(P.a)(this,"sampleAddr",void 0),Object(P.a)(this,"sampleLength",void 0),Object(P.a)(this,"clocks",void 0),Object(P.a)(this,"sampleBuffer",void 0),Object(P.a)(this,"addr",void 0),Object(P.a)(this,"bitsRemaining",void 0),this.volume=0,this.isEnabled=!1,this.bytesRemaining=0,this.isInterrupted=!1,this.isMuted=!0,this.isIRQEnabled=!1,this.isLoopEnabled=!1,this.frequency=0,this.loadCounter=0,this.sampleAddr=0,this.sampleLength=0,this.clocks=0,this.sampleBuffer=0,this.addr=0,this.bitsRemaining=0}return O(e,[{key:"tick",value:function(){this.isEnabled&&(this.clocks%(L[this.frequency]+1)===0&&this.outputUnit(),this.clocks++)}},{key:"cpuWrite",value:function(e,t){switch(e){case 0:this.isIRQEnabled=!!(128&t),this.isLoopEnabled=!!(64&t),this.frequency=15&t,this.clocks=0,this.isIRQEnabled||(this.isInterrupted=!1);break;case 1:this.loadCounter=127&t,this.restart();break;case 2:this.sampleAddr=49152+64*t,this.restart();break;case 3:this.sampleLength=16*t+1,this.restart()}}},{key:"outputUnit",value:function(){if(this.bitsRemaining<=0){if(this.isMuted)return;this.memoryReader(),this.bitsRemaining=8}1&this.sampleBuffer?this.volume=this.volume>125?127:this.volume+2:this.volume=this.volume<2?0:this.volume-2,this.sampleBuffer>>=1,this.bitsRemaining--}},{key:"memoryReader",value:function(){this.bytesRemaining<=0||this.bitsRemaining>0||(this.sampleBuffer=this.cpuBus.readByte(this.addr),this.addr=this.addr>=65535?32768:this.addr+1,this.bytesRemaining--,this.bytesRemaining<=0&&(this.isLoopEnabled?this.restart():(this.isMuted=!0,this.isIRQEnabled&&(this.isInterrupted=!0,this.interrupt.irq()))))}},{key:"restart",value:function(){this.addr=this.sampleAddr,this.bytesRemaining=this.sampleLength,this.isMuted=!1,this.volume=this.loadCounter}}]),e}(),N=function(){function e(){k(this,e),Object(P.a)(this,"volume",void 0),Object(P.a)(this,"lengthCounter",void 0),Object(P.a)(this,"enabled",void 0),Object(P.a)(this,"internalTimer",void 0),Object(P.a)(this,"isConstant",void 0),Object(P.a)(this,"envelopeValue",void 0),Object(P.a)(this,"envelopeVolume",void 0),Object(P.a)(this,"envelopeCounter",void 0),Object(P.a)(this,"isLengthCounterHalt",void 0),Object(P.a)(this,"isLoopNoise",void 0),Object(P.a)(this,"noisePeriod",void 0),this.volume=0,this.enabled=!1,this.lengthCounter=0,this.internalTimer=0,this.isConstant=!1,this.envelopeValue=0,this.envelopeVolume=0,this.envelopeCounter=0,this.isLengthCounterHalt=!1,this.isLoopNoise=!1,this.noisePeriod=0}return O(e,[{key:"tick",value:function(){this.isEnabled&&(0===this.internalTimer?(this.internalTimer=this.noisePeriod,this.process()):this.internalTimer--)}},{key:"envelope",value:function(){this.isConstant||(this.envelopeCounter%(this.envelopeValue+1)===0&&(0===this.envelopeVolume?this.envelopeVolume=this.isLengthCounterHalt?15:0:this.envelopeVolume--),this.envelopeCounter++)}},{key:"countLinear",value:function(){}},{key:"countLength",value:function(){!this.isLengthCounterHalt&&this.lengthCounter>0&&this.lengthCounter--}},{key:"sweep",value:function(){}},{key:"cpuWrite",value:function(e,t){switch(e){case 0:this.isLengthCounterHalt=!!(32&t),this.isConstant=!!(16&t),this.envelopeValue=15&t,this.envelopeVolume=15,this.envelopeCounter=0;break;case 1:break;case 2:this.isLoopNoise=!!(128&t),this.noisePeriod=j[15&t],this.internalTimer=0;break;case 3:this.lengthCounter=w[t>>3]}}},{key:"process",value:function(){this.isEnabled&&0!==this.lengthCounter?this.isConstant?this.volume=Math.floor(Math.random()*this.envelopeValue):this.volume=Math.floor(Math.random()*this.envelopeVolume):this.volume=0}},{key:"isEnabled",get:function(){return this.enabled},set:function(e){this.enabled=e,e||(this.lengthCounter=0)}}]),e}(),I=function(){function e(t){k(this,e),this.channel=t,Object(P.a)(this,"volume",void 0),Object(P.a)(this,"lengthCounter",void 0),Object(P.a)(this,"enabled",void 0),Object(P.a)(this,"timer",void 0),Object(P.a)(this,"internalTimer",void 0),Object(P.a)(this,"counter",void 0),Object(P.a)(this,"duty",void 0),Object(P.a)(this,"isConstant",void 0),Object(P.a)(this,"envelopeValue",void 0),Object(P.a)(this,"envelopeVolume",void 0),Object(P.a)(this,"envelopeCounter",void 0),Object(P.a)(this,"isEnvelopeLoop",void 0),Object(P.a)(this,"isSweepEnabled",void 0),Object(P.a)(this,"sweepPeriod",void 0),Object(P.a)(this,"isSweepNegated",void 0),Object(P.a)(this,"sweepShift",void 0),Object(P.a)(this,"sweepCounter",void 0),this.volume=0,this.enabled=!1,this.lengthCounter=0,this.timer=0,this.internalTimer=0,this.counter=0,this.duty=0,this.isConstant=!1,this.envelopeValue=0,this.envelopeVolume=0,this.envelopeCounter=0,this.isEnvelopeLoop=!1,this.isSweepEnabled=!1,this.sweepPeriod=0,this.isSweepNegated=!1,this.sweepShift=0,this.sweepCounter=0}return O(e,[{key:"tick",value:function(){this.isEnabled&&(0===this.internalTimer?(this.internalTimer=this.timer,this.process()):this.internalTimer--)}},{key:"envelope",value:function(){this.isConstant||(this.envelopeCounter%(this.envelopeValue+1)===0&&(0===this.envelopeVolume?this.envelopeVolume=this.isEnvelopeLoop?15:0:this.envelopeVolume--),this.envelopeCounter++)}},{key:"countLinear",value:function(){}},{key:"countLength",value:function(){!this.isEnvelopeLoop&&this.lengthCounter>0&&this.lengthCounter--}},{key:"sweep",value:function(){if(this.isSweepEnabled){if(this.sweepCounter%(this.sweepPeriod+1)===0){var e=this.isSweepNegated?-(this.timer>>this.sweepShift):this.timer>>this.sweepShift;this.timer+=e,1===this.channel&&e<=0&&this.timer--}this.sweepCounter++}}},{key:"cpuWrite",value:function(e,t){switch(e){case 0:this.duty=t>>6,this.isEnvelopeLoop=!!(32&t),this.isConstant=!!(16&t),this.envelopeValue=15&t,this.envelopeVolume=15,this.envelopeCounter=0;break;case 1:this.isSweepEnabled=!!(128&t),this.sweepPeriod=t>>4&7,this.isSweepNegated=!!(8&t),this.sweepShift=7&t,this.sweepCounter=0;break;case 2:this.timer=65280&this.timer|t;break;case 3:this.timer=255&this.timer|t<<8&2047,this.lengthCounter=w[t>>3],this.internalTimer=0}}},{key:"process",value:function(){this.counter++,!this.isEnabled||0===this.lengthCounter||this.timer<8||this.timer>2047?this.volume=0:this.isConstant?this.volume=this.envelopeValue*S[this.duty][7&this.counter]:this.volume=this.envelopeVolume*S[this.duty][7&this.counter]}},{key:"isEnabled",get:function(){return this.enabled},set:function(e){this.enabled=e,e||(this.lengthCounter=0)}}]),e}(),X=function(){function e(){k(this,e),Object(P.a)(this,"volume",void 0),Object(P.a)(this,"lengthCounter",void 0),Object(P.a)(this,"enabled",void 0),Object(P.a)(this,"timer",void 0),Object(P.a)(this,"internalTimer",void 0),Object(P.a)(this,"counter",void 0),Object(P.a)(this,"isLengthCounterHalt",void 0),Object(P.a)(this,"linearCounterLoad",void 0),Object(P.a)(this,"isLinearCounterReload",void 0),Object(P.a)(this,"linearCounterValue",void 0),this.volume=0,this.enabled=!1,this.lengthCounter=0,this.timer=0,this.internalTimer=0,this.counter=0,this.isLengthCounterHalt=!1,this.linearCounterLoad=0,this.isLinearCounterReload=!1,this.linearCounterValue=0}return O(e,[{key:"tick",value:function(){this.isEnabled&&(0===this.internalTimer?(this.internalTimer=this.timer,this.process()):this.internalTimer--)}},{key:"envelope",value:function(){}},{key:"countLinear",value:function(){this.isLinearCounterReload?this.linearCounterValue=this.linearCounterLoad:this.linearCounterValue>0&&this.linearCounterValue--,this.isLengthCounterHalt||(this.isLinearCounterReload=!1)}},{key:"countLength",value:function(){!this.isLengthCounterHalt&&this.lengthCounter>0&&this.lengthCounter--}},{key:"sweep",value:function(){}},{key:"cpuWrite",value:function(e,t){switch(e){case 0:this.isLengthCounterHalt=!!(128&t),this.linearCounterLoad=127&t;break;case 1:break;case 2:this.timer=65280&this.timer|t;break;case 3:this.timer=255&this.timer|t<<8&2047,this.lengthCounter=w[t>>3],this.isLinearCounterReload=!0,this.internalTimer=0}}},{key:"process",value:function(){this.counter++,this.isEnabled&&0!==this.lengthCounter&&0!==this.linearCounterValue||this.counter--,this.volume=B[31&this.counter]}},{key:"isEnabled",get:function(){return this.enabled},set:function(e){this.enabled=e,e||(this.lengthCounter=0)}}]),e}(),E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:48e3,s=arguments.length>1?arguments[1]:void 0;k(this,e),this.sampleRate=t,this.onSample=s,Object(P.a)(this,"interruptLine",void 0),Object(P.a)(this,"pulse1",void 0),Object(P.a)(this,"pulse2",void 0),Object(P.a)(this,"noise",void 0),Object(P.a)(this,"triangle",void 0),Object(P.a)(this,"dmc",void 0),Object(P.a)(this,"isFrameInterrupted",void 0),Object(P.a)(this,"mode",void 0),Object(P.a)(this,"isIRQEnabled",void 0),Object(P.a)(this,"clocks",void 0),Object(P.a)(this,"sampleCounter",void 0),Object(P.a)(this,"frameCounter",void 0),this.pulse1=new I(1),this.pulse2=new I(2),this.noise=new N,this.triangle=new X,this.dmc=new R,this.isFrameInterrupted=!1,this.mode=0,this.isIRQEnabled=!0,this.clocks=0,this.sampleCounter=0,this.frameCounter=0}return O(e,[{key:"tick",value:function(){this.clocks++,1&this.clocks&&(this.pulse1.tick(),this.pulse2.tick(),this.noise.tick()),this.dmc.tick(),this.triangle.tick();var e=Math.floor(this.clocks/(1789773/this.sampleRate));e!==this.sampleCounter&&(this.sampleCounter=e,this.sample());var t=Math.floor(this.clocks/7457.3875);t!==this.frameCounter&&(this.frameCounter=t,this.countFrame())}},{key:"cpuRead",value:function(e){if(16405===e){var t=(this.pulse1.lengthCounter>0?1:0)|(this.pulse2.lengthCounter>0?2:0)|(this.triangle.lengthCounter>0?4:0)|(this.noise.lengthCounter>0?8:0)|(this.dmc.bytesRemaining>0?16:0)|(this.isFrameInterrupted?64:0)|(this.dmc.isInterrupted?128:0);return this.isFrameInterrupted=!1,t}return 0}},{key:"cpuWrite",value:function(e,t){switch(e){case 16384:case 16385:case 16386:case 16387:this.pulse1.cpuWrite(e-16384,t);break;case 16388:case 16389:case 16390:case 16391:this.pulse2.cpuWrite(e-16388,t);break;case 16392:case 16393:case 16394:case 16395:this.triangle.cpuWrite(e-16392,t);break;case 16396:case 16397:case 16398:case 16399:this.noise.cpuWrite(e-16396,t);break;case 16400:case 16401:case 16402:case 16403:this.dmc.cpuWrite(e-16400,t);break;case 16405:this.pulse1.isEnabled=!!(1&t),this.pulse2.isEnabled=!!(2&t),this.triangle.isEnabled=!!(4&t),this.noise.isEnabled=!!(8&t),this.dmc.isEnabled=!!(16&t),this.dmc.isInterrupted=!1;break;case 16407:this.frameCounter=0,this.mode=t>>7,this.isIRQEnabled=!(64&t)}}},{key:"sample",value:function(){var e=.00752*(this.pulse1.volume+this.pulse2.volume),t=.00851*this.triangle.volume+.00494*this.noise.volume+.00335*this.dmc.volume;this.onSample(e+t)}},{key:"countFrame",value:function(){if(0===this.mode)switch(this.frameCounter%4){case 0:this.envelopeAndCountLinear();break;case 1:this.countLengthAndSweep(),this.envelopeAndCountLinear();break;case 2:this.envelopeAndCountLinear();break;case 3:this.irq(),this.countLengthAndSweep(),this.envelopeAndCountLinear()}else switch(this.frameCounter%5){case 0:this.envelopeAndCountLinear();break;case 1:this.countLengthAndSweep(),this.envelopeAndCountLinear();break;case 2:this.envelopeAndCountLinear();break;case 3:break;case 4:this.countLengthAndSweep(),this.envelopeAndCountLinear()}}},{key:"envelopeAndCountLinear",value:function(){this.pulse1.envelope(),this.pulse2.envelope(),this.noise.envelope(),this.triangle.countLinear()}},{key:"countLengthAndSweep",value:function(){this.pulse1.countLength(),this.pulse2.countLength(),this.triangle.countLength(),this.noise.countLength(),this.pulse1.sweep(),this.pulse2.sweep()}},{key:"irq",value:function(){this.isIRQEnabled&&(this.isFrameInterrupted=!0,this.interruptLine.irq())}},{key:"cpuBus",set:function(e){this.dmc.cpuBus=e}},{key:"interrupt",set:function(e){this.interruptLine=e,this.dmc.interrupt=e}}]),e}(),M=0,_=1,x=2,D=3,Y=4,Z=function(){function e(){k(this,e),Object(P.a)(this,"rom",void 0),Object(P.a)(this,"ram",void 0),Object(P.a)(this,"bgPalette",void 0),Object(P.a)(this,"spPalette",void 0)}return O(e,[{key:"readByte",value:function(e){return(e&=16383)<8192?this.rom.mapper.read(e):e<12288?this.ram.read(this.mirrored(e)):e<16128?this.readByte(e-4096):(e&=16159)<16144?this.bgPalette.read(e):3&e?this.spPalette.read(e):this.bgPalette.read(e-16)}},{key:"writeByte",value:function(e,t){return(e&=16383)<8192?this.rom.mapper.write(e,t):e<12288?this.ram.write(this.mirrored(e),t):e<16128?this.writeByte(e-4096,t):(e&=16159)<16144?this.bgPalette.write(e,t):3&e?this.spPalette.write(e,t):this.bgPalette.write(e-16,t)}},{key:"readWord",value:function(e){return this.readByte(e+1)<<8|this.readByte(e)}},{key:"writeWord",value:function(e,t){this.writeByte(e,t),this.writeByte(e+1,t>>8)}},{key:"mirrored",value:function(e){switch(this.rom.header.mirror){case M:return 9215&e|(2048&e?1024:0);case _:return 10239&e;case x:return e;case D:return 9215&e;case Y:return 10239&e;default:throw new Error("invalid mirror type: '".concat(this.rom.header.mirror,"'"))}}}]),e}(),T=function(){function e(){k(this,e),Object(P.a)(this,"rom",void 0),Object(P.a)(this,"ram",void 0),Object(P.a)(this,"ppu",void 0),Object(P.a)(this,"apu",void 0),Object(P.a)(this,"dma",void 0),Object(P.a)(this,"player1",void 0),Object(P.a)(this,"player2",void 0)}return O(e,[{key:"writeByte",value:function(e,t){var s=this;return e<8192?this.ram.write(2047&e,t):e<16384?this.ppu.cpuWrite(8199&e,t):16404===e?this.dma.copy(t<<8):16406===e?function(e){s.player1.write(e),s.player2.write(e)}(t):e<16408?this.apu.cpuWrite(e,t):e<16416?void 0:this.rom.mapper.write(e,t)}},{key:"writeWord",value:function(e,t){this.writeByte(e,255&t),this.writeByte(e+1,t>>8&255)}},{key:"readByte",value:function(e){return e<8192?this.ram.read(2047&e):e<16384?this.ppu.cpuRead(8199&e):16404===e?0:16406===e?this.player1.read():16407===e?this.player2.read():e<16408?this.apu.cpuRead(e):e<16416?0:this.rom.mapper.read(e)}},{key:"readWord",value:function(e){return 65535&(this.readByte(e+1)<<8|this.readByte(e))}}]),e}(),V=function(){function e(){k(this,e),Object(P.a)(this,"data",void 0),Object(P.a)(this,"isStrobe",!1),Object(P.a)(this,"offset",0)}return O(e,[{key:"update",value:function(e,t){t?this.data|=e:this.data&=255&~e}},{key:"write",value:function(e){1&e?this.isStrobe=!0:(this.offset=0,this.isStrobe=!1)}},{key:"read",value:function(){return(this.isStrobe?this.data&l:this.data&128>>this.offset++)?1:0}}]),e}(),H=1,W=2,U=4,z=8,F=16,q=32,Q=64,K=128,J=[{inst:"BRK",addr:"ZP0",bytes:2,cycles:7,pageCycles:0},{inst:"ORA",addr:"INX",bytes:2,cycles:6,pageCycles:0},void 0,{inst:"SLO",addr:"INX",bytes:2,cycles:8,pageCycles:0},{inst:"NOP",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"ORA",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"ASL",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"SLO",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"PHP",addr:"IMP",bytes:1,cycles:3,pageCycles:0},{inst:"ORA",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"ASL",addr:"ACC",bytes:1,cycles:2,pageCycles:0},void 0,{inst:"NOP",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"ORA",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"ASL",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"SLO",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"BPL",addr:"REL",bytes:2,cycles:2,pageCycles:1},{inst:"ORA",addr:"INY",bytes:2,cycles:5,pageCycles:1},void 0,{inst:"SLO",addr:"INY",bytes:2,cycles:8,pageCycles:0},{inst:"NOP",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"ORA",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"ASL",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"SLO",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"CLC",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"ORA",addr:"ABY",bytes:3,cycles:4,pageCycles:1},{inst:"NOP",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"SLO",addr:"ABY",bytes:3,cycles:7,pageCycles:0},{inst:"NOP",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"ORA",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"ASL",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"SLO",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"JSR",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"AND",addr:"INX",bytes:2,cycles:6,pageCycles:0},void 0,{inst:"RLA",addr:"INX",bytes:2,cycles:8,pageCycles:0},{inst:"BIT",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"AND",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"ROL",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"RLA",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"PLP",addr:"IMP",bytes:1,cycles:4,pageCycles:0},{inst:"AND",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"ROL",addr:"ACC",bytes:1,cycles:2,pageCycles:0},void 0,{inst:"BIT",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"AND",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"ROL",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"RLA",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"BMI",addr:"REL",bytes:2,cycles:2,pageCycles:1},{inst:"AND",addr:"INY",bytes:2,cycles:5,pageCycles:1},void 0,{inst:"RLA",addr:"INY",bytes:2,cycles:8,pageCycles:0},{inst:"NOP",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"AND",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"ROL",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"RLA",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"SEC",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"AND",addr:"ABY",bytes:3,cycles:4,pageCycles:1},{inst:"NOP",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"RLA",addr:"ABY",bytes:3,cycles:7,pageCycles:0},{inst:"NOP",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"AND",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"ROL",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"RLA",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"RTI",addr:"IMP",bytes:1,cycles:6,pageCycles:0},{inst:"EOR",addr:"INX",bytes:2,cycles:6,pageCycles:0},void 0,{inst:"SRE",addr:"INX",bytes:2,cycles:8,pageCycles:0},{inst:"NOP",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"EOR",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"LSR",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"SRE",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"PHA",addr:"IMP",bytes:1,cycles:3,pageCycles:0},{inst:"EOR",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"LSR",addr:"ACC",bytes:1,cycles:2,pageCycles:0},void 0,{inst:"JMP",addr:"ABS",bytes:3,cycles:3,pageCycles:0},{inst:"EOR",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"LSR",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"SRE",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"BVC",addr:"REL",bytes:2,cycles:2,pageCycles:1},{inst:"EOR",addr:"INY",bytes:2,cycles:5,pageCycles:1},void 0,{inst:"SRE",addr:"INY",bytes:2,cycles:8,pageCycles:0},{inst:"NOP",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"EOR",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"LSR",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"SRE",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"CLI",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"EOR",addr:"ABY",bytes:3,cycles:4,pageCycles:1},{inst:"NOP",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"SRE",addr:"ABY",bytes:3,cycles:7,pageCycles:0},{inst:"NOP",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"EOR",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"LSR",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"SRE",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"RTS",addr:"IMP",bytes:1,cycles:6,pageCycles:0},{inst:"ADC",addr:"INX",bytes:2,cycles:6,pageCycles:0},void 0,{inst:"RRA",addr:"INX",bytes:2,cycles:8,pageCycles:0},{inst:"NOP",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"ADC",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"ROR",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"RRA",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"PLA",addr:"IMP",bytes:1,cycles:4,pageCycles:0},{inst:"ADC",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"ROR",addr:"ACC",bytes:1,cycles:2,pageCycles:0},void 0,{inst:"JMP",addr:"IND",bytes:3,cycles:5,pageCycles:0},{inst:"ADC",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"ROR",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"RRA",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"BVS",addr:"REL",bytes:2,cycles:2,pageCycles:1},{inst:"ADC",addr:"INY",bytes:2,cycles:5,pageCycles:1},void 0,{inst:"RRA",addr:"INY",bytes:2,cycles:8,pageCycles:0},{inst:"NOP",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"ADC",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"ROR",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"RRA",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"SEI",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"ADC",addr:"ABY",bytes:3,cycles:4,pageCycles:1},{inst:"NOP",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"RRA",addr:"ABY",bytes:3,cycles:7,pageCycles:0},{inst:"NOP",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"ADC",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"ROR",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"RRA",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"NOP",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"STA",addr:"INX",bytes:2,cycles:6,pageCycles:0},{inst:"NOP",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"SAX",addr:"INX",bytes:2,cycles:6,pageCycles:0},{inst:"STY",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"STA",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"STX",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"SAX",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"DEY",addr:"IMP",bytes:1,cycles:2,pageCycles:0},void 0,{inst:"TXA",addr:"IMP",bytes:1,cycles:2,pageCycles:0},void 0,{inst:"STY",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"STA",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"STX",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"SAX",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"BCC",addr:"REL",bytes:2,cycles:2,pageCycles:1},{inst:"STA",addr:"INY",bytes:2,cycles:6,pageCycles:0},void 0,void 0,{inst:"STY",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"STA",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"STX",addr:"ZPY",bytes:2,cycles:4,pageCycles:0},{inst:"SAX",addr:"ZPY",bytes:2,cycles:4,pageCycles:0},{inst:"TYA",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"STA",addr:"ABY",bytes:3,cycles:5,pageCycles:0},{inst:"TXS",addr:"IMP",bytes:1,cycles:2,pageCycles:0},void 0,void 0,{inst:"STA",addr:"ABX",bytes:3,cycles:5,pageCycles:0},void 0,void 0,{inst:"LDY",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"LDA",addr:"INX",bytes:2,cycles:6,pageCycles:0},{inst:"LDX",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"LAX",addr:"INX",bytes:2,cycles:6,pageCycles:0},{inst:"LDY",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"LDA",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"LDX",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"LAX",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"TAY",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"LDA",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"TAX",addr:"IMP",bytes:1,cycles:2,pageCycles:0},void 0,{inst:"LDY",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"LDA",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"LDX",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"LAX",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"BCS",addr:"REL",bytes:2,cycles:2,pageCycles:1},{inst:"LDA",addr:"INY",bytes:2,cycles:5,pageCycles:1},void 0,{inst:"LAX",addr:"INY",bytes:2,cycles:5,pageCycles:1},{inst:"LDY",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"LDA",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"LDX",addr:"ZPY",bytes:2,cycles:4,pageCycles:0},{inst:"LAX",addr:"ZPY",bytes:2,cycles:4,pageCycles:0},{inst:"CLV",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"LDA",addr:"ABY",bytes:3,cycles:4,pageCycles:1},{inst:"TSX",addr:"IMP",bytes:1,cycles:2,pageCycles:0},void 0,{inst:"LDY",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"LDA",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"LDX",addr:"ABY",bytes:3,cycles:4,pageCycles:1},{inst:"LAX",addr:"ABY",bytes:3,cycles:4,pageCycles:1},{inst:"CPY",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"CMP",addr:"INX",bytes:2,cycles:6,pageCycles:0},void 0,{inst:"DCP",addr:"INX",bytes:2,cycles:8,pageCycles:0},{inst:"CPY",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"CMP",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"DEC",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"DCP",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"INY",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"CMP",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"DEX",addr:"IMP",bytes:1,cycles:2,pageCycles:0},void 0,{inst:"CPY",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"CMP",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"DEC",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"DCP",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"BNE",addr:"REL",bytes:2,cycles:2,pageCycles:1},{inst:"CMP",addr:"INY",bytes:2,cycles:5,pageCycles:1},void 0,{inst:"DCP",addr:"INY",bytes:2,cycles:8,pageCycles:0},{inst:"NOP",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"CMP",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"DEC",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"DCP",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"CLD",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"CMP",addr:"ABY",bytes:3,cycles:4,pageCycles:1},{inst:"NOP",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"DCP",addr:"ABY",bytes:3,cycles:7,pageCycles:0},{inst:"NOP",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"CMP",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"DEC",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"DCP",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"CPX",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"SBC",addr:"INX",bytes:2,cycles:6,pageCycles:0},void 0,{inst:"ISC",addr:"INX",bytes:2,cycles:8,pageCycles:0},{inst:"CPX",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"SBC",addr:"ZP0",bytes:2,cycles:3,pageCycles:0},{inst:"INC",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"ISC",addr:"ZP0",bytes:2,cycles:5,pageCycles:0},{inst:"INX",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"SBC",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"NOP",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"SBC",addr:"IMM",bytes:2,cycles:2,pageCycles:0},{inst:"CPX",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"SBC",addr:"ABS",bytes:3,cycles:4,pageCycles:0},{inst:"INC",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"ISC",addr:"ABS",bytes:3,cycles:6,pageCycles:0},{inst:"BEQ",addr:"REL",bytes:2,cycles:2,pageCycles:1},{inst:"SBC",addr:"INY",bytes:2,cycles:5,pageCycles:1},void 0,{inst:"ISC",addr:"INY",bytes:2,cycles:8,pageCycles:0},{inst:"NOP",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"SBC",addr:"ZPX",bytes:2,cycles:4,pageCycles:0},{inst:"INC",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"ISC",addr:"ZPX",bytes:2,cycles:6,pageCycles:0},{inst:"SED",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"SBC",addr:"ABY",bytes:3,cycles:4,pageCycles:1},{inst:"NOP",addr:"IMP",bytes:1,cycles:2,pageCycles:0},{inst:"ISC",addr:"ABY",bytes:3,cycles:7,pageCycles:0},{inst:"NOP",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"SBC",addr:"ABX",bytes:3,cycles:4,pageCycles:1},{inst:"INC",addr:"ABX",bytes:3,cycles:7,pageCycles:0},{inst:"ISC",addr:"ABX",bytes:3,cycles:7,pageCycles:0}],G=function e(){k(this,e),Object(P.a)(this,"PC",0),Object(P.a)(this,"SP",0),Object(P.a)(this,"P",0),Object(P.a)(this,"A",0),Object(P.a)(this,"X",0),Object(P.a)(this,"Y",0)},$=function(){function e(){k(this,e),Object(P.a)(this,"bus",void 0),Object(P.a)(this,"suspendCycles",0),Object(P.a)(this,"deferCycles",0),Object(P.a)(this,"registers",new G)}return O(e,[{key:"tick",value:function(){this.suspendCycles>0?this.suspendCycles--:(0===this.deferCycles&&this.next(),this.deferCycles--)}},{key:"next",value:function(){var e=this.bus.readByte(this.registers.PC++),t=J[e];if(!t)throw new Error("invalid opcode '0x".concat(e.toString(16),"', pc: 0x").concat((this.registers.PC-1).toString(16)));if("???"!==t.inst){var s=this.address(t);s.crossing&&(this.deferCycles+=t.pageCycles),this.instruct(t,s),this.deferCycles+=t.cycles}}},{key:"address",value:function(e){switch(e.addr){case"ABS":var t=this.bus.readWord(this.registers.PC);return this.registers.PC+=2,{addr:65535&t,data:NaN,crossing:!1};case"ABX":var s=this.bus.readWord(this.registers.PC);this.registers.PC+=2;var i=s+this.registers.X;return{addr:65535&i,data:NaN,crossing:this.isCrossing(s,i)};case"ABY":var r=this.bus.readWord(this.registers.PC);this.registers.PC+=2;var a=r+this.registers.Y;return{addr:65535&a,data:NaN,crossing:this.isCrossing(r,a)};case"ACC":return{addr:NaN,data:this.registers.A,crossing:!1};case"IMM":return{addr:NaN,data:this.bus.readByte(this.registers.PC++),crossing:!1};case"IMP":return{addr:NaN,data:NaN,crossing:!1};case"IND":var c=this.bus.readWord(this.registers.PC);return this.registers.PC+=2,{addr:65535&(c=255===(255&c)?this.bus.readByte(65280&c)<<8|this.bus.readByte(c):this.bus.readWord(c)),data:NaN,crossing:!1};case"INY":var n=this.bus.readByte(this.registers.PC++),h=this.bus.readByte(n+1&255)<<8|this.bus.readByte(255&n),d=h+this.registers.Y;return{addr:65535&d,data:NaN,crossing:this.isCrossing(h,d)};case"REL":var l=this.bus.readByte(this.registers.PC++);return 128&l&&(l-=256),{addr:this.registers.PC+l&65535,data:NaN,crossing:!1};case"INX":var o=this.bus.readByte(this.registers.PC++)+this.registers.X;return{addr:65535&(this.bus.readByte(o+1&255)<<8|this.bus.readByte(255&o)),data:NaN,crossing:!1};case"ZP0":return{addr:65535&this.bus.readByte(this.registers.PC++),data:NaN,crossing:!1};case"ZPX":return{addr:65535&(this.bus.readByte(this.registers.PC++)+this.registers.X&255),data:NaN,crossing:!1};case"ZPY":return{addr:65535&(this.bus.readByte(this.registers.PC++)+this.registers.Y&255),data:NaN,crossing:!1};default:throw new Error("unsuppored addressing mode: ".concat(e.addr))}}},{key:"instruct",value:function(e,t){switch(e.inst){case"ADC":var s=this.fetch(t),i=s+this.registers.A+(this.check(H)?1:0);return this.flag(H,i>255),this.flag(Q,!!(~(this.registers.A^s)&(this.registers.A^i)&128)),this.passthrough(i),void(this.registers.A=255&i);case"AND":return this.registers.A&=this.fetch(t),void this.passthrough(this.registers.A);case"ASL":var r=this.fetch(t)<<1;return this.flag(H,!!(256&r)),r&=255,this.passthrough(r),void(isNaN(t.addr)?this.registers.A=r:this.bus.writeByte(t.addr,r));case"BCC":return void(this.check(H)||(this.deferCycles++,this.isCrossing(this.registers.PC,t.addr)&&this.deferCycles++,this.registers.PC=t.addr));case"BCS":return void(this.check(H)&&(this.deferCycles++,this.isCrossing(this.registers.PC,t.addr)&&this.deferCycles++,this.registers.PC=t.addr));case"BEQ":return void(this.check(W)&&(this.deferCycles++,this.isCrossing(this.registers.PC,t.addr)&&this.deferCycles++,this.registers.PC=t.addr));case"BIT":var a=this.fetch(t);return this.flag(W,!(this.registers.A&a)),this.flag(K,!!(128&a)),void this.flag(Q,!!(64&a));case"BMI":return void(this.check(K)&&(this.deferCycles++,this.isCrossing(this.registers.PC,t.addr)&&this.deferCycles++,this.registers.PC=t.addr));case"BNE":return void(this.check(W)||(this.deferCycles++,this.isCrossing(this.registers.PC,t.addr)&&this.deferCycles++,this.registers.PC=t.addr));case"BPL":return void(this.check(K)||(this.deferCycles++,this.isCrossing(this.registers.PC,t.addr)&&this.deferCycles++,this.registers.PC=t.addr));case"BRK":return this.pushWord(this.registers.PC),this.pushByte(this.registers.P|F|q),this.flag(U,!0),void(this.registers.PC=this.bus.readWord(65534));case"BVC":return void(this.check(Q)||(this.deferCycles++,this.isCrossing(this.registers.PC,t.addr)&&this.deferCycles++,this.registers.PC=t.addr));case"BVS":return void(this.check(Q)&&(this.deferCycles++,this.isCrossing(this.registers.PC,t.addr)&&this.deferCycles++,this.registers.PC=t.addr));case"CLC":return void this.flag(H,!1);case"CLD":return void this.flag(z,!1);case"CLI":return void this.flag(U,!1);case"CLV":return void this.flag(Q,!1);case"CMP":var c=this.fetch(t),n=this.registers.A-c;return this.flag(H,this.registers.A>=c),void this.passthrough(n);case"CPX":var h=this.fetch(t),d=this.registers.X-h;return this.flag(H,this.registers.X>=h),void this.passthrough(d);case"CPY":var l=this.fetch(t),o=this.registers.Y-l;return this.flag(H,this.registers.Y>=l),void this.passthrough(o);case"DEC":var u=this.fetch(t)-1&255;return this.bus.writeByte(t.addr,u),void this.passthrough(u);case"DEX":return this.registers.X=this.registers.X-1&255,void this.passthrough(this.registers.X);case"DEY":return this.registers.Y=this.registers.Y-1&255,void this.passthrough(this.registers.Y);case"EOR":return this.registers.A^=this.fetch(t),void this.passthrough(this.registers.A);case"INC":var y=this.fetch(t)+1&255;return this.bus.writeByte(t.addr,y),void this.passthrough(y);case"INX":return this.registers.X=this.registers.X+1&255,void this.passthrough(this.registers.X);case"INY":return this.registers.Y=this.registers.Y+1&255,void this.passthrough(this.registers.Y);case"JMP":return void(this.registers.PC=t.addr);case"JSR":return this.pushWord(this.registers.PC-1),void(this.registers.PC=t.addr);case"LDA":return this.registers.A=this.fetch(t),void this.passthrough(this.registers.A);case"LDX":return this.registers.X=this.fetch(t),void this.passthrough(this.registers.X);case"LDY":return this.registers.Y=this.fetch(t),void this.passthrough(this.registers.Y);case"LSR":var p=this.fetch(t);return this.flag(H,!!(1&p)),p>>=1,this.passthrough(p),void(isNaN(t.addr)?this.registers.A=p:this.bus.writeByte(t.addr,p));case"NOP":return;case"ORA":return this.registers.A|=this.fetch(t),void this.passthrough(this.registers.A);case"PHA":return void this.pushByte(this.registers.A);case"PHP":return void this.pushByte(this.registers.P|F|q);case"PLA":return this.registers.A=this.popByte(),void this.passthrough(this.registers.A);case"PLP":return this.registers.P=this.popByte(),this.flag(F,!1),void this.flag(q,!0);case"ROL":var g=this.fetch(t),b=this.check(H);return this.flag(H,!!(128&g)),g=255&(g<<1|(b?1:0)),this.passthrough(g),void(isNaN(t.addr)?this.registers.A=g:this.bus.writeByte(t.addr,g));case"ROR":var v=this.fetch(t),f=this.check(H);return this.flag(H,!!(1&v)),v=v>>1|(f?128:0),this.passthrough(v),void(isNaN(t.addr)?this.registers.A=v:this.bus.writeByte(t.addr,v));case"RTI":return this.registers.P=this.popByte(),this.flag(F,!1),this.flag(q,!0),void(this.registers.PC=this.popWord());case"RTS":return void(this.registers.PC=this.popWord()+1);case"SBC":var C=this.fetch(t),m=this.registers.A-C-(this.check(H)?0:1);return this.passthrough(m),this.flag(H,m>=0),this.flag(Q,!!((m^this.registers.A)&(m^C^255)&128)),void(this.registers.A=255&m);case"SEC":return void this.flag(H,!0);case"SED":return void this.flag(z,!0);case"SEI":return void this.flag(U,!0);case"STA":return void this.bus.writeByte(t.addr,this.registers.A);case"STX":return void this.bus.writeByte(t.addr,this.registers.X);case"STY":return void this.bus.writeByte(t.addr,this.registers.Y);case"TAX":return this.registers.X=this.registers.A,void this.passthrough(this.registers.X);case"TAY":return this.registers.Y=this.registers.A,void this.passthrough(this.registers.Y);case"TSX":return this.registers.X=this.registers.SP,void this.passthrough(this.registers.X);case"TXA":return this.registers.A=this.registers.X,void this.passthrough(this.registers.A);case"TXS":return void(this.registers.SP=this.registers.X);case"TYA":return this.registers.A=this.registers.Y,void this.passthrough(this.registers.A);default:throw new Error("unsuppored instruction: ".concat(e.inst))}}},{key:"rst",value:function(){this.registers.A=0,this.registers.X=0,this.registers.Y=0,this.registers.P=0,this.registers.SP=253,this.registers.PC=this.bus.readWord(65532),this.deferCycles=8}},{key:"irq",value:function(){this.check(U)||(this.pushWord(this.registers.PC),this.pushByte((this.registers.P|q)&~F),this.flag(U,!0),this.registers.PC=this.bus.readWord(65534),this.deferCycles+=7)}},{key:"nmi",value:function(){this.pushWord(this.registers.PC),this.pushByte((this.registers.P|q)&~F),this.flag(U,!0),this.registers.PC=this.bus.readWord(65530),this.deferCycles+=7}},{key:"fetch",value:function(e){return isNaN(e.data)?this.bus.readByte(e.addr):e.data}},{key:"flag",value:function(e,t){t?this.registers.P|=e:this.registers.P&=~e}},{key:"check",value:function(e){return!!(this.registers.P&e)}},{key:"passthrough",value:function(e){this.flag(W,0===(255&e)),this.flag(K,!!(128&e))}},{key:"pushWord",value:function(e){this.pushByte(e>>8),this.pushByte(e)}},{key:"pushByte",value:function(e){this.bus.writeByte(256+this.registers.SP,e),this.registers.SP=this.registers.SP-1&255}},{key:"popWord",value:function(){return this.popByte()|this.popByte()<<8}},{key:"popByte",value:function(){return this.registers.SP=this.registers.SP+1&255,this.bus.readByte(256+this.registers.SP)}},{key:"isCrossing",value:function(e,t){return(65280&e)!==(65280&t)}}]),e}(),ee=function(){function e(){k(this,e),Object(P.a)(this,"cpu",void 0),Object(P.a)(this,"ppu",void 0)}return O(e,[{key:"copy",value:function(e){for(var t=new Uint8Array(256),s=0;s<256;s++)t[s]=this.cpu.bus.readByte(e+s);this.ppu.dma(t),this.cpu.suspendCycles=1&this.cpu.cycles?513:514}}]),e}(),te=function(){function e(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;k(this,e),this.offset=s,Object(P.a)(this,"data",void 0),this.data=new Uint8Array(t)}return O(e,[{key:"read",value:function(e){return this.data[e-this.offset&65535]}},{key:"write",value:function(e,t){this.data[e-this.offset&65535]=t}}]),e}(),se=function(){function e(){k(this,e),Object(P.a)(this,"cpu",void 0)}return O(e,[{key:"irq",value:function(){this.cpu.irq()}},{key:"nmi",value:function(){this.cpu.nmi()}}]),e}(),ie=8,re=16,ae=[8192,9216,10240,11264],ce=function(){function e(){k(this,e),Object(P.a)(this,"ntableAddr",ae[0]),Object(P.a)(this,"vramInc",1),Object(P.a)(this,"spPttrAddr",0),Object(P.a)(this,"bgPttrAddr",0),Object(P.a)(this,"spSize",ie),Object(P.a)(this,"isNMIEnabled",!1)}return O(e,[{key:"data",set:function(e){this.ntableAddr=ae[3&e],this.vramInc=4&e?32:1,this.spPttrAddr=8&e?4096:0,this.bgPttrAddr=16&e?4096:0,this.spSize=32&e?re:ie,this.isNMIEnabled=!!(128&e)},get:function(){return ae.indexOf(this.ntableAddr)|(1===this.vramInc?0:1)<<2|(this.spPttrAddr?1:0)<<3|(this.bgPttrAddr?1:0)<<4|(this.spSize===ie?0:1)<<5|(this.isNMIEnabled?1:0)<<7}}]),e}(),ne=function(){function e(){k(this,e),Object(P.a)(this,"isColorful",void 0),Object(P.a)(this,"isShowBgLeft8px",void 0),Object(P.a)(this,"isShowSpLeft8px",void 0),Object(P.a)(this,"isShowBg",void 0),Object(P.a)(this,"isShowSp",void 0),Object(P.a)(this,"emphasizeRed",void 0),Object(P.a)(this,"emphasizeGreen",void 0),Object(P.a)(this,"emphasizeBlue",void 0)}return O(e,[{key:"data",set:function(e){this.isColorful=!(1&e),this.isShowBgLeft8px=!!(2&e),this.isShowSpLeft8px=!!(4&e),this.isShowBg=!!(8&e),this.isShowSp=!!(16&e),this.emphasizeRed=!!(32&e),this.emphasizeGreen=!!(64&e),this.emphasizeBlue=!!(128&e)},get:function(){return(this.isColorful?0:1)|(this.isShowBgLeft8px?1:0)<<1|(this.isShowSpLeft8px?1:0)<<2|(this.isShowBg?1:0)<<3|(this.isShowSp?1:0)<<4|(this.emphasizeRed?1:0)<<5|(this.emphasizeGreen?1:0)<<6|(this.emphasizeBlue?1:0)<<7}}]),e}(),he=function(){function e(){k(this,e),Object(P.a)(this,"isSpOverflow",void 0),Object(P.a)(this,"isZeroSpHit",void 0),Object(P.a)(this,"isVBlankStarted",void 0)}return O(e,[{key:"data",get:function(){return(this.isSpOverflow?32:0)|(this.isZeroSpHit?64:0)|(this.isVBlankStarted?128:0)}}]),e}();function de(e,t){var s;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(s=function(e,t){if(!e)return;if("string"===typeof e)return le(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return le(e,t)}(e))||t&&e&&"number"===typeof e.length){s&&(e=s);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,n=!1;return{s:function(){s=e[Symbol.iterator]()},n:function(){var e=s.next();return c=e.done,e},e:function(e){n=!0,a=e},f:function(){try{c||null==s.return||s.return()}finally{if(n)throw a}}}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}var oe=function(){function e(t){k(this,e),this.onFrame=t,Object(P.a)(this,"bus",void 0),Object(P.a)(this,"mapper",void 0),Object(P.a)(this,"interrupt",void 0),Object(P.a)(this,"pixels",void 0),Object(P.a)(this,"oam1",void 0),Object(P.a)(this,"controller",void 0),Object(P.a)(this,"mask",void 0),Object(P.a)(this,"status",void 0),Object(P.a)(this,"register",void 0),Object(P.a)(this,"shifter",void 0),Object(P.a)(this,"latch",void 0),Object(P.a)(this,"nmiDelay",void 0),Object(P.a)(this,"frame",void 0),Object(P.a)(this,"scanLine",void 0),Object(P.a)(this,"cycle",void 0),Object(P.a)(this,"oamAddr",void 0),Object(P.a)(this,"oam2",void 0),Object(P.a)(this,"spritePixels",void 0),this.pixels=new Uint8Array(61440),this.oam1=new Uint8Array(256),this.controller=new ce,this.mask=new ne,this.status=new he,this.register={vramaddr:0,tramaddr:0,fineX:0,toggle:!1},this.shifter={},this.latch={},this.nmiDelay=0,this.frame=0,this.scanLine=240,this.cycle=340,this.oamAddr=0,this.oam2=Array(8).fill(0).map((function(){return Object.create(null)})),this.spritePixels=new Array(256)}return O(e,[{key:"tick",value:function(){261===this.scanLine&&339===this.cycle&&1&this.frame&&(this.mask.isShowBg||this.mask.isShowSp)&&this.ticked(),this.ticked(),(this.mask.isShowBg||this.mask.isShowSp)&&(0<=this.scanLine&&this.scanLine<=239&&(1===this.cycle&&this.clearSp(),65===this.cycle&&this.evaluateSp(),1<=this.cycle&&this.cycle<=256&&(this.shiftBg(),this.draw(),this.fetchBg()),256===this.cycle&&this.scrollY(),257===this.cycle&&this.copyHBits(),257===this.cycle&&this.fetchSp(),321<=this.cycle&&this.cycle<=336&&(this.shiftBg(),this.fetchBg())),261===this.scanLine&&(1<=this.cycle&&this.cycle<=256&&(this.shiftBg(),this.fetchBg()),256===this.cycle&&this.scrollY(),257===this.cycle&&this.copyHBits(),280===this.cycle&&this.copyVBits(),321<=this.cycle&&this.cycle<=336&&(this.shiftBg(),this.fetchBg())))}},{key:"cpuRead",value:function(e){switch(e){case 8192:return this.controller.data;case 8193:return this.mask.data;case 8194:var t=this.status.data|this.latch.status;return this.status.isVBlankStarted=!1,this.register.toggle=!1,t;case 8195:return 0;case 8196:return this.oam1[this.oamAddr];case 8197:case 8198:return 0;case 8199:var s=this.bus.readByte(this.register.vramaddr);if(this.register.vramaddr<=16127){var i=this.register.tramaddr;this.register.tramaddr=s,s=i}else this.register.tramaddr=this.bus.readByte(this.register.vramaddr-4096);return this.register.vramaddr+=this.controller.vramInc,this.register.vramaddr&=32767,s}return 0}},{key:"cpuWrite",value:function(e,t){switch(t&=255,this.latch.status=31&t,e){case 8192:this.controller.data=t,this.register.tramaddr=62463&this.register.tramaddr|(3&t)<<10;break;case 8193:this.mask.data=t;break;case 8194:break;case 8195:this.oamAddr=t;break;case 8196:this.oam1[255&this.oamAddr++]=t;break;case 8197:this.register.toggle?(this.register.tramaddr=3103&this.register.tramaddr|(7&t)<<12|(248&t)<<2,this.register.toggle=!1):(this.register.tramaddr=65504&this.register.tramaddr|t>>3,this.register.fineX=7&t,this.register.toggle=!0);break;case 8198:this.register.toggle?(this.register.tramaddr=65280&this.register.tramaddr|t,this.register.vramaddr=this.register.tramaddr,this.register.toggle=!1):(this.register.tramaddr=33023&this.register.tramaddr|(63&t)<<8,this.register.toggle=!0);break;case 8199:this.bus.writeByte(this.register.vramaddr,t),this.register.vramaddr+=this.controller.vramInc}}},{key:"dma",value:function(e){for(var t=0;t<256;t++)this.oam1[t+this.oamAddr&255]=e[t]}},{key:"ticked",value:function(){this.status.isVBlankStarted&&this.controller.isNMIEnabled&&0===this.nmiDelay--&&this.interrupt.nmi(),this.cycle++,this.cycle>340&&(this.cycle=0,this.scanLine++,this.scanLine>261&&(this.scanLine=0,this.frame++,this.onFrame(this.pixels))),241===this.scanLine&&1===this.cycle&&(this.status.isVBlankStarted=!0,this.controller.isNMIEnabled&&(this.nmiDelay=15)),261===this.scanLine&&1===this.cycle&&(this.status.isVBlankStarted=!1,this.status.isZeroSpHit=!1,this.status.isSpOverflow=!1),(this.mask.isShowBg||this.mask.isShowSp)&&this.mapper.handlePPUClock(this.scanLine,this.cycle)}},{key:"fetchBg",value:function(){if(this.mask.isShowBg)switch(7&this.cycle){case 1:this.shifter.bgLo|=this.latch.bgLo,this.shifter.bgHi|=this.latch.bgHi,this.shifter.bgAttrLo|=1&this.latch.attr?255:0,this.shifter.bgAttrHi|=2&this.latch.attr?255:0;var e=8192|4095&this.register.vramaddr;this.latch.ntable=this.bus.readByte(e);break;case 3:var t=9152|3072&this.register.vramaddr|this.register.vramaddr>>4&56|this.register.vramaddr>>2&7,s=!!(2&this.register.vramaddr),i=(!!(64&this.register.vramaddr)?2:0)|(s?1:0);this.latch.attr=this.bus.readByte(t)>>(i<<1)&3;break;case 5:var r=this.controller.bgPttrAddr+16*this.latch.ntable+(this.register.vramaddr>>12&7);this.latch.bgLo=this.bus.readByte(r);break;case 7:var a=this.controller.bgPttrAddr+16*this.latch.ntable+(this.register.vramaddr>>12&7)+8;this.latch.bgHi=this.bus.readByte(a);break;case 0:31===(31&this.register.vramaddr)?(this.register.vramaddr&=-32,this.register.vramaddr^=1024):this.register.vramaddr+=1}}},{key:"shiftBg",value:function(){this.mask.isShowBg&&(this.shifter.bgLo<<=1,this.shifter.bgHi<<=1,this.shifter.bgAttrLo<<=1,this.shifter.bgAttrHi<<=1)}},{key:"scrollY",value:function(){if(28672!==(28672&this.register.vramaddr))this.register.vramaddr+=4096;else{this.register.vramaddr&=-28673;var e=(992&this.register.vramaddr)>>5;29===e?(e=0,this.register.vramaddr^=2048):31===e?e=0:e+=1,this.register.vramaddr=-993&this.register.vramaddr|e<<5}}},{key:"copyHBits",value:function(){this.register.vramaddr=64480&this.register.vramaddr|-64481&this.register.tramaddr&32767}},{key:"copyVBits",value:function(){this.register.vramaddr=33823&this.register.vramaddr|-33824&this.register.tramaddr&32767}},{key:"draw",value:function(){var e=this.cycle-1,t=this.scanLine,s=32768>>this.register.fineX,i=(this.shifter.bgAttrHi&s?1:0)<<3|(this.shifter.bgAttrLo&s?1:0)<<2|(this.shifter.bgHi&s?1:0)<<1|(this.shifter.bgLo&s?1:0)<<0,r=63&this.spritePixels[e],a=r%4===0||!this.mask.isShowSp,c=16128;i%4===0||!this.mask.isShowBg?a||(c=16144+r):a?c=16128+i:(128&this.spritePixels[e]&&this.mask.isShowBg&&this.mask.isShowSp&&(0>e||e>7||this.mask.isShowSpLeft8px&&this.mask.isShowBgLeft8px)&&255!==e&&(this.status.isZeroSpHit=!0),c=64&this.spritePixels[e]?16128+i:16144+r),this.pixels[e+256*t]=this.bus.readByte(c)}},{key:"clearSp",value:function(){this.mask.isShowSp&&this.oam2.forEach((function(e){e.attr=255,e.tile=255,e.x=255,e.y=255}))}},{key:"evaluateSp",value:function(){if(this.mask.isShowSp)for(var e=0,t=0;t<64;t++){var s=this.oam1[4*t];if(!(this.scanLine<s||this.scanLine>=s+this.controller.spSize)){if(8===e){this.status.isSpOverflow=!0;break}var i=this.oam2[e++];i.y=s,i.tile=this.oam1[4*t+1],i.attr=this.oam1[4*t+2],i.x=this.oam1[4*t+3],i.isZero=0===t}}}},{key:"fetchSp",value:function(){if(this.mask.isShowSp){this.spritePixels.fill(0);var e,t=de(this.oam2.reverse());try{for(t.s();!(e=t.n()).done;){var s=e.value;if(!(s.y>=239)){var i=!!(32&s.attr),r=s.isZero,a=!!(64&s.attr),c=!!(128&s.attr),n=void 0;if(this.controller.spSize===ie){n=this.controller.spPttrAddr+(s.tile<<4)+(c?7-this.scanLine+s.y:this.scanLine-s.y)}else{var h=(1&s.tile?4096:0)+((254&s.tile)<<4),d=c?15-this.scanLine+s.y:this.scanLine-s.y;n=h+d%8+16*Math.floor(d/8)}for(var l=this.bus.readByte(n+0),o=this.bus.readByte(n+8),u=0;u<8;u++){var y=a?1<<u:128>>u,p=(2&s.attr?1:0)<<3|(1&s.attr?1:0)<<2|(o&y?1:0)<<1|(l&y?1:0);p%4===0&&(63&this.spritePixels[s.x+u])%4!==0||(this.spritePixels[s.x+u]=p|(i?64:0)|(r?128:0))}}}}catch(g){t.e(g)}finally{t.f()}}}}]),e}(),ue=function(){function e(t,s,i,r){k(this,e),this.rom=t,this.ram=s,this.prg=i,this.chr=r,Object(P.a)(this,"interrupt",void 0),Object(P.a)(this,"isMirrored",void 0),this.isMirrored=16384===i.length,0===r.length&&(this.chr=new Uint8Array(8192))}return O(e,[{key:"read",value:function(e){return(e&=65535)<8192?this.chr[this.map(e)]:e>=32768?this.prg[this.map(e)]:e>=24576?this.ram[e-24576]:0}},{key:"write",value:function(e,t){(e&=65535)<8192?this.chr[this.map(e)]=t:e>=32768?this.prg[this.map(e)]=t:e>=24576&&(this.ram[e-24576]=t)}},{key:"handlePPUClock",value:function(e,t){}},{key:"map",value:function(e){return e<8192?e:(this.isMirrored?49151&e:e)-32768}}]),e}(),ye=function(){function e(t,s,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i.length>>14;k(this,e),this.rom=t,this.ram=s,this.prg=i,this.chr=r,this.prgBanks=a,Object(P.a)(this,"interrupt",void 0),Object(P.a)(this,"shifter",16),Object(P.a)(this,"chrBankMode",0),Object(P.a)(this,"chrBanks",[0,0]),Object(P.a)(this,"prgBankMode",0),Object(P.a)(this,"prgBank",0),this.chr=new Uint8Array(131072),this.chr.set(r),this.prgBankMode=3}return O(e,[{key:"read",value:function(e){return(e&=65535)<8192?this.readChr(e):e>=32768?this.readPrg(e):e>=24576?this.ram[e-24576]:0}},{key:"write",value:function(e,t){(e&=65535)<8192?this.writeChr(e,t):e>=32768?this.readReg(e,t):e>=24576&&(this.ram[e-24576]=t)}},{key:"handlePPUClock",value:function(e,t){}},{key:"readReg",value:function(e,t){if(128&t)this.shifter=16,this.prgBankMode=3;else{var s=!!(1&this.shifter);this.shifter>>=1,this.shifter|=1&t?16:0,s&&(this.writeReg(e,this.shifter),this.shifter=16)}}},{key:"writeReg",value:function(e,t){if(e<40960){switch(3&t){case 0:this.rom.header.mirror=D;break;case 1:this.rom.header.mirror=Y;break;case 2:this.rom.header.mirror=_;break;case 3:this.rom.header.mirror=M}return this.prgBankMode=t>>2&3,void(this.chrBankMode=t>>4&1)}e<49152?this.chrBanks[0]=31&t:e<57344?this.chrBanks[1]=31&t:this.prgBank=15&t}},{key:"readChr",value:function(e){return this.chr[this.chrOffset(e)]}},{key:"writeChr",value:function(e,t){this.chr[this.chrOffset(e)]=t}},{key:"readPrg",value:function(e){return this.prg[this.prgOffset(e)]}},{key:"chrOffset",value:function(e){return this.chrBankMode?(this.chrBanks[e>>12]<<12)+(4095&e):((30&this.chrBanks[0])<<12)+e}},{key:"prgOffset",value:function(e){switch(e-=32768,this.prgBankMode){case 0:case 1:return((14&this.prgBank)<<14)+e;case 2:return e>>14===0?16383&e:(this.prgBank<<14)+(16383&e);case 3:return e>>14===0?(this.prgBank<<14)+(16383&e):(this.prgBanks-1<<14)+(16383&e)}}}]),e}(),pe=function(){function e(t,s,i,r){k(this,e),this.rom=t,this.ram=s,this.prg=i,this.chr=r,Object(P.a)(this,"interrupt",void 0),Object(P.a)(this,"bankSelect",0),this.chr=new Uint8Array(8192),this.chr.set(r)}return O(e,[{key:"read",value:function(e){return(e&=65535)<8192?this.chr[e]:e>=32768?e<49152?this.prg[(this.bankSelect<<14)+e-32768]:this.prg[this.prg.length-16384+(e-49152)]:e>=24576?this.ram[e-24576]:0}},{key:"write",value:function(e,t){(e&=65535)<8192?this.chr[e]=t:e>=32768?this.bankSelect=15&t:e>=24576&&(this.ram[e-24576]=t)}},{key:"handlePPUClock",value:function(e,t){}}]),e}(),ge=function(){function e(t,s,i,r){k(this,e),this.rom=t,this.ram=s,this.prg=i,this.chr=r,Object(P.a)(this,"interrupt",void 0),Object(P.a)(this,"chrBankSelect",0),this.chr=new Uint8Array(32768),this.chr.set(r),this.prg=new Uint8Array(32768),this.prg.set(i),16384===i.length&&this.prg.set(i,16384)}return O(e,[{key:"read",value:function(e){return(e&=65535)<8192?this.chr[(this.chrBankSelect<<13)+e]:e>=32768?this.prg[e-32768]:e>=24576?this.ram[e-24576]:0}},{key:"write",value:function(e,t){(e&=65535)<8192?this.chr[(this.chrBankSelect<<13)+e]=t:e>=32768?this.chrBankSelect=3&t:e>=24576&&(this.ram[e-24576]=t)}},{key:"handlePPUClock",value:function(e,t){}}]),e}(),be=function(){function e(t,s){k(this,e),Object(P.a)(this,"mapper",void 0),Object(P.a)(this,"header",{}),e.check(t),this.parse(t);var i=t.slice(this.header.isTrained?528:16,(this.header.isTrained?528:16)+16*this.header.prg*1024),r=t.slice((this.header.isTrained?528:16)+i.length,(this.header.isTrained?528:16)+i.length+8*this.header.chr*1024);switch(this.header.mapper){case 0:this.mapper=new ue(this,s,i,r);break;case 1:this.mapper=new ye(this,s,i,r);break;case 2:this.mapper=new pe(this,s,i,r);break;case 3:this.mapper=new ge(this,s,i,r);break;default:throw new Error("unsupported mapper: ".concat(this.header.mapper))}}return O(e,[{key:"parse",value:function(e){this.header.prg=e[4],this.header.chr=e[5],this.header.mapper=e[7]>>4<<4|e[6]>>4,this.header.mirror=8&e[6]?x:1&e[6]?_:M,this.header.hasBattery=!!(2&e[6]),this.header.isTrained=!!(4&e[6])}}],[{key:"check",value:function(e){for(var t="NES\x1a",s=0;s<t.length;s++)if(e[s]!==t.charCodeAt(s))throw new Error("Invalid nes file");if(8===(12&e[7]))throw new Error("NES2.0 is not currently supported")}}]),e}(),ve=[8421504,187,3604671,8650918,12255338,11993118,11730944,9512448,8071936,15872,18445,15394,12134,0,328965,328965,13158600,23039,4472063,12006348,16724906,16725854,16725786,13978368,12870144,3963648,1999893,38246,33988,1118481,592137,592137,16777215,38399,7308543,13987839,16742348,16740249,16743257,16748895,16753203,10927872,5364074,5100974,55807,6710886,855309,855309,16777215,8699903,12303359,13679615,16760810,16760780,16762039,16764078,16767394,13427097,11464375,11204590,11792127,14540253,1118481,1118481];var fe=function(){function e(t,s){var i=this;k(this,e),Object(P.a)(this,"rom",void 0),Object(P.a)(this,"player1",void 0),Object(P.a)(this,"player2",void 0),Object(P.a)(this,"sram",void 0),Object(P.a)(this,"cpu",void 0),Object(P.a)(this,"ppu",void 0),Object(P.a)(this,"apu",void 0),Object(P.a)(this,"dma",void 0),Object(P.a)(this,"ppuRam",void 0),Object(P.a)(this,"cpuRam",void 0),Object(P.a)(this,"cpuBus",void 0),Object(P.a)(this,"ppuBus",void 0),Object(P.a)(this,"bgPalette",void 0),Object(P.a)(this,"spPalette",void 0),Object(P.a)(this,"interrupt",void 0),s=this.parse(s),this.sram=new Uint8Array(8192),this.sram.set(s.sramLoad);var r=new V,a=new V,c=new $,n=new oe((function(e){return s.onFrame(i.palette(e))})),h=new E(s.sampleRate,s.onSample),d=new ee,l=new be(t,this.sram),o=new te(2048,8192),u=new te(2048,0),y=new T,p=new Z,g=new te(16,16128),b=new te(16,16144),v=new se;c.bus=y,n.interrupt=v,n.bus=p,n.mapper=l.mapper,h.cpuBus=y,h.interrupt=v,d.cpu=c,d.ppu=n,v.cpu=c,p.rom=l,p.ram=o,p.bgPalette=g,p.spPalette=b,y.rom=l,y.ram=u,y.ppu=n,y.apu=h,y.dma=d,y.player1=r,y.player2=a,l.mapper.interrupt=v,this.cpu=c,this.ppu=n,this.apu=h,this.rom=l,this.ppuRam=o,this.cpuRam=u,this.cpuBus=y,this.ppuBus=p,this.bgPalette=g,this.spPalette=b,this.dma=d,this.player1=r,this.player2=a,this.cpu.rst()}return O(e,[{key:"tick",value:function(){this.cpu.tick(),this.apu.tick(),this.ppu.tick(),this.ppu.tick(),this.ppu.tick()}},{key:"frame",value:function(){for(var e=this.ppu.frame;;){if(this.tick(),this.ppu.frame!==e)break}}},{key:"palette",value:function(e){var t=new Uint32Array(e.length),s=0;return e.forEach((function(e){t[s++]=ve[e]})),t}},{key:"parse",value:function(e){return{sampleRate:(e=e||{}).sampleRate||48e3,onSample:e.onSample||function(){},onFrame:e.onFrame||function(){},sramLoad:e.sramLoad||new Uint8Array(8192)}}}]),e}(),Ce=function(){function e(t,s,i){var r=this;k(this,e),Object(P.a)(this,"nes",void 0),Object(P.a)(this,"bufferSize",void 0),Object(P.a)(this,"width",void 0),Object(P.a)(this,"height",void 0),Object(P.a)(this,"intervalID",void 0),Object(P.a)(this,"audCtx",void 0),Object(P.a)(this,"visCtx",void 0),Object(P.a)(this,"source",void 0),Object(P.a)(this,"node",void 0),Object(P.a)(this,"buffer",void 0),i=this.parse(i),this.bufferSize=i.bufferSize,this.width=i.width,this.height=i.height,this.visCtx=t.getContext("2d"),this.audCtx=new AudioContext({sampleRate:i.sampleRate}),this.source=this.audCtx.createBufferSource(),this.node=this.audCtx.createScriptProcessor(this.bufferSize,0,1),this.buffer=[],this.nes=new fe(s,{sampleRate:this.sampleRate,onSample:function(e){return r.onSample(e)},onFrame:function(e){return r.onFrame(e)},sramLoad:void 0})}return O(e,[{key:"start",value:function(){var e=this;this.node.onaudioprocess=function(t){return e.process(t)},this.source.connect(this.node),this.node.connect(this.audCtx.destination),this.source.start(),this.intervalID=setInterval((function(){e.waitSample()}),1)}},{key:"onSample",value:function(e){this.buffer.push(e)}},{key:"onFrame",value:function(e){for(var t=this.visCtx.createImageData(this.width,this.height),s=0,i=0;i<this.height;i++)for(var r=0;r<this.width;r++){var a=i*this.width+r;t.data[s++]=e[a]>>16&255,t.data[s++]=e[a]>>8&255,t.data[s++]=e[a]>>0&255,t.data[s++]=255}this.visCtx.putImageData(t,0,0)}},{key:"parse",value:function(e){return{sampleRate:(e=e||{}).sampleRate||24e3,bufferSize:e.bufferSize||256,width:e.width||256,height:e.height||240}}},{key:"process",value:function(e){for(var t=e.outputBuffer.getChannelData(0),s=0;s<t.length;s++)t[s]=this.buffer.shift()}},{key:"waitSample",value:function(){try{for(;this.buffer.length<4*this.bufferSize;)this.nes.tick()}catch(e){console.log(e),this.visCtx.clearRect(0,0,this.width,this.height),this.visCtx.textAlign="center",this.visCtx.fillText(e,128,120),this.intervalID&&clearInterval(this.intervalID)}}},{key:"sampleRate",get:function(){return this.audCtx.sampleRate}}]),e}(),me=s("Oc3m"),ke=s.n(me),Ae=function(e){return Object(i.jsx)("div",{className:ke.a.logo,children:"WebNES"})},Oe=s("k66e"),Pe=s.n(Oe),we=n.a.forwardRef((function(e,t){var s=Object(c.useRef)(),r=Object(c.useRef)(),a=Object(c.useRef)();return n.a.useImperativeHandle(t,(function(){return{keydownStart:function(){s.current.classList.add(Pe.a.active)},keyupStart:function(){s.current.classList.remove(Pe.a.active)},keydownSelect:function(){r.current.classList.add(Pe.a.active)},keyupSelect:function(){r.current.classList.remove(Pe.a.active)},keydownRom:function(){a.current.classList.add(Pe.a.active)},keyupRom:function(){a.current.classList.remove(Pe.a.active)}}})),Object(i.jsxs)("div",{className:Pe.a["pill-buttons"],children:[Object(i.jsx)("div",{ref:r,className:Pe.a["pill-button"],children:Object(i.jsx)("label",{className:"select",children:"SELECT"})}),Object(i.jsx)("div",{ref:s,className:Pe.a["pill-button"],children:Object(i.jsx)("label",{className:"start",children:"START"})}),Object(i.jsxs)("div",{ref:a,className:Pe.a["cart-button"],children:[Object(i.jsx)("input",{id:"ines",type:"file",accept:".nes",onChange:function(t){e.onChange(t.target.files[0])},hidden:!0}),Object(i.jsx)("label",{className:"rom",htmlFor:"ines",children:"ROM"})]})]})})),Se=s("1YUq"),je=s.n(Se),Be=n.a.forwardRef((function(e,t){var s=Object(c.useRef)();return n.a.useImperativeHandle(t,(function(){return{get canvas(){return s.current}}})),Object(i.jsx)("div",{className:je.a.screen,children:Object(i.jsx)("div",{className:je.a.display,children:Object(i.jsx)("canvas",{ref:s,width:e.width,height:e.height})})})})),Le=function(e){var t,s=Object(c.useRef)(),r=Object(c.useRef)(),a=Object(c.useRef)();n.a.useEffect((function(){document.addEventListener("keyup",(function(e){switch(e.code){case"ArrowUp":r.current.keyupUp(),t&&t.nes&&(t.nes.player1.update(p,!1),t.nes.player2.update(p,!1));break;case"ArrowDown":r.current.keyupDown(),t&&t.nes&&(t.nes.player1.update(g,!1),t.nes.player2.update(g,!1));break;case"ArrowLeft":r.current.keyupLeft(),t&&t.nes&&(t.nes.player1.update(b,!1),t.nes.player2.update(b,!1));break;case"ArrowRight":r.current.keyupRight(),t&&t.nes&&(t.nes.player1.update(v,!1),t.nes.player2.update(v,!1));break;case"Enter":a.current.keyupStart(),t&&t.nes&&(t.nes.player1.update(y,!1),t.nes.player2.update(y,!1));break;case"Space":a.current.keyupSelect(),t&&t.nes&&(t.nes.player1.update(u,!1),t.nes.player2.update(u,!1));break;case"KeyX":r.current.keyupA(),t&&t.nes&&(t.nes.player1.update(l,!1),t.nes.player2.update(l,!1));break;case"KeyZ":r.current.keyupB(),t&&t.nes&&(t.nes.player1.update(o,!1),t.nes.player2.update(o,!1))}e.preventDefault()})),document.addEventListener("keydown",(function(e){switch(e.code){case"ArrowUp":r.current.keydownUp(),t&&t.nes&&(t.nes.player1.update(p,!0),t.nes.player2.update(p,!0));break;case"ArrowDown":r.current.keydownDown(),t&&t.nes&&(t.nes.player1.update(g,!0),t.nes.player2.update(g,!0));break;case"ArrowLeft":r.current.keydownLeft(),t&&t.nes&&(t.nes.player1.update(b,!0),t.nes.player2.update(b,!0));break;case"ArrowRight":r.current.keydownRight(),t&&t.nes&&(t.nes.player1.update(v,!0),t.nes.player2.update(v,!0));break;case"Enter":a.current.keydownStart(),t&&t.nes&&(t.nes.player1.update(y,!0),t.nes.player2.update(y,!0));break;case"Space":a.current.keydownSelect(),t&&t.nes&&(t.nes.player1.update(u,!0),t.nes.player2.update(u,!0));break;case"KeyX":r.current.keydownA(),t&&t.nes&&(t.nes.player1.update(l,!0),t.nes.player2.update(l,!0));break;case"KeyZ":r.current.keydownB(),t&&t.nes&&(t.nes.player1.update(o,!0),t.nes.player2.update(o,!0))}e.preventDefault()}))}));return Object(i.jsxs)("div",{className:d.a.emulator,children:[Object(i.jsx)(Be,{ref:s,width:e.width,height:e.height}),Object(i.jsx)(Ae,{}),Object(i.jsx)(m,{ref:r}),Object(i.jsx)(we,{ref:a,onChange:function(e){t&&t.intervalID&&clearInterval(t.intervalID),console.log("test");var i=new FileReader;i.onload=function(e){try{console.log("loaded"),(t=new Ce(s.current.canvas,new Uint8Array(e.target.result))).start()}catch(e){console.log(e);var i=s.current.canvas.getContext("2d");i.clearRect(0,0,t.width,t.height),i.textAlign="center",i.fillText(e,128,120),t&&t.intervalID&&clearInterval(t.intervalID)}},i.readAsArrayBuffer(e)}})]})};function Re(){return Object(i.jsx)("div",{className:a.a.root,children:Object(i.jsx)(Le,{width:256,height:240})})}},Oc3m:function(e,t,s){e.exports={logo:"Logo_logo__1oa79"}},Qetd:function(e,t,s){"use strict";var i=Object.assign.bind(Object);e.exports=i,e.exports.default=e.exports},cpVT:function(e,t,s){"use strict";function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,"a",(function(){return i}))},hDqR:function(e,t,s){e.exports={emulator:"NES_emulator__JmgqH"}},k66e:function(e,t,s){e.exports={"pill-buttons":"Pills_pill-buttons__17G9W","pill-button":"Pills_pill-button__1bHN4",active:"Pills_active__cWnFE","cart-button":"Pills_cart-button__dVrIu"}},vRNQ:function(e,t,s){e.exports={root:"Home_root__3H0ev"}},zi88:function(e,t,s){e.exports={"action-buttons":"Actions_action-buttons__xtKoL",dpad:"Actions_dpad__3FP-B","up-button":"Actions_up-button__2wUk6",active:"Actions_active__KN7i7","right-button":"Actions_right-button__3c7pA","down-button":"Actions_down-button__126Cb","left-button":"Actions_left-button__3U_1N","dent-button":"Actions_dent-button__3KeU6",arrow:"Actions_arrow__3nizl","up-arrow":"Actions_up-arrow__Vw7X8","right-arrow":"Actions_right-arrow__j6KFy","down-arrow":"Actions_down-arrow__2ob1Z","left-arrow":"Actions_left-arrow__2N3ze","dent-circle":"Actions_dent-circle__1iaVI","dent-highlight":"Actions_dent-highlight__1_BnD","ab-button":"Actions_ab-button__1AOKZ","a-button":"Actions_a-button__1gnpR","b-button":"Actions_b-button__22Bhm","button-height":"Actions_button-height__sB7HV"}}},[["/EDR",0,1]]]);